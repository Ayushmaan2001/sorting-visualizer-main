"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const tslib_1 = require("tslib");
class Splitter {
    constructor(options) {
        this.options = options;
    }
    splitAndOutputSortedGroups(inputStream) {
        return tslib_1.__awaiter(this, void 0, void 0, function* () {
            const inputStreams = [];
            while (true) {
                const group = yield this.getNextGroup(inputStream);
                if (group.length === 0) {
                    break;
                }
                const groupInputStream = yield this.outputSortedGroup(group, inputStreams.length);
                inputStreams.push(groupInputStream);
            }
            return inputStreams;
        });
    }
    getNextGroup(inputStream) {
        return tslib_1.__awaiter(this, void 0, void 0, function* () {
            const group = [];
            const { maxGroupSize } = this.options;
            while (group.length < maxGroupSize) {
                const value = yield inputStream.read();
                if (value === null) {
                    break;
                }
                group.push(value);
            }
            return group;
        });
    }
    outputSortedGroup(group, index) {
        return tslib_1.__awaiter(this, void 0, void 0, function* () {
            const { comparator, groupOutputStreamCreator } = this.options;
            group.sort(comparator);
            const outputStream = groupOutputStreamCreator(index);
            yield outputStream.batchWrite(group);
            outputStream.end();
            return outputStream.getInputStream();
        });
    }
}
exports.Splitter = Splitter;
//# sourceMappingURL=splitter.js.map